{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://thinkwider.co/schemas/docanax.struct.v0.1.min.json",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema", "document", "hashes", "structure", "segments"],
  "properties": {
    "schema": { "const": "docanax.struct.v0.1" },

    "document": {
      "type": "object",
      "additionalProperties": false,
      "required": ["document_id", "source_filename", "mime_type", "byte_length", "ingest_timestamp_utc"],
      "properties": {
        "document_id": { "type": "string" },
        "source_filename": { "type": "string" },
        "mime_type": { "const": "application/pdf" },
        "byte_length": { "type": "integer", "minimum": 0 },
        "ingest_timestamp_utc": { "type": "string" }
      }
    },

    "hashes": {
      "type": "object",
      "additionalProperties": false,
      "required": ["document_sha256", "canonical_text_sha256", "structure_sha256"],
      "properties": {
        "document_sha256": { "$ref": "#/$defs/sha256" },
        "canonical_text_sha256": { "$ref": "#/$defs/sha256" },
        "structure_sha256": { "$ref": "#/$defs/sha256" }
      }
    },

    "structure": {
      "type": "object",
      "additionalProperties": false,
      "required": ["pages"],
      "properties": {
        "pages": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["page_index", "width_pt", "height_pt", "rotation"],
            "properties": {
              "page_index": { "type": "integer", "minimum": 0 },
              "width_pt": { "type": "number", "minimum": 0 },
              "height_pt": { "type": "number", "minimum": 0 },
              "rotation": { "type": "integer" }
            }
          }
        }
      }
    },

    "segments": {
      "type": "array",
      "items": { "$ref": "#/$defs/segment" }
    }
  },

  "$defs": {
    "sha256": { "type": "string", "pattern": "^[0-9a-f]{64}$" },

    "segment": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "type", "order", "parent_id", "path", "content", "source_trace", "segment_hashes", "flags"],
      "properties": {
        "id": { "type": "string" },
        "type": { "type": "string" },
        "order": { "type": "integer", "minimum": 1 },
        "parent_id": { "type": ["string", "null"] },
        "path": { "type": "string" },

        "content": {
          "type": "object",
          "additionalProperties": false,
          "required": ["text", "language", "normalized_text"],
          "properties": {
            "text": { "type": "string" },
            "language": { "type": "string" },
            "normalized_text": { "type": "string" }
          }
        },

        "source_trace": {
          "type": "object",
          "additionalProperties": false,
          "required": ["page_index", "bbox_pt", "char_range", "lineage"],
          "properties": {
            "page_index": { "type": "integer", "minimum": 0 },
            "bbox_pt": { "type": "array", "minItems": 4, "maxItems": 4, "items": { "type": "number" } },
            "char_range": { "type": "array", "minItems": 2, "maxItems": 2, "items": { "type": "integer", "minimum": 0 } },
            "lineage": {
              "type": "object",
              "additionalProperties": false,
              "required": ["from_object", "confidence"],
              "properties": {
                "from_object": { "type": "string" },
                "confidence": { "type": "number", "minimum": 0, "maximum": 1 }
              }
            }
          }
        },

        "segment_hashes": {
          "type": "object",
          "additionalProperties": false,
          "required": ["content_sha256", "position_sha256", "stable_hash_sha256"],
          "properties": {
            "content_sha256": { "$ref": "#/$defs/sha256" },
            "position_sha256": { "$ref": "#/$defs/sha256" },
            "stable_hash_sha256": { "$ref": "#/$defs/sha256" }
          }
        },

        "flags": { "type": "object" }
      }
    }
  }
}
